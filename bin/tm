#!/bin/ksh

[[ ${1} || -f ${1} ]] || exit 1

nthline() {
    head -n $((${1} + 1)) ${2} | tail -n 1
}

remkd ${XDG_CACHE_HOME}/tm

cp -r ${XDG_CONFIG_HOME}/tm/* ${XDG_CACHE_HOME}/tm

ns=`seq 15 -1 0`

for i in ${XDG_CACHE_HOME}/tm/*; {
    contents=`< ${i}`
    for n in ${ns}; {
        contents=${contents//X${n}/`nthline ${n} ${1}`}
    }
    print "${contents}" > ${i}
}
