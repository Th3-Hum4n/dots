#!/bin/dash
# brightness script.
sub_dir=$(ls /sys/class/backlight)
max_brightness=$(cat /sys/class/backlight/${sub_dir}/max_brightness)
current_brightness=$(cat /sys/class/backlight/${sub_dir}/brightness)

set_per_bright() {
    # assumes that number has a percent sign
    local brightness_to_be_set=${1%*%}
    bright=$(( brightness_to_be_set * max_brightness / 100))

    echo $bright > /sys/class/backlight/${sub_dir}/brightness
}

inc() {
    local inc_bright=${1%*%}
    inc_bright=$(( inc_bright * max_brightness / 100 ))

    echo $(( inc_bright + current_brightness ))> /sys/class/backlight/${sub_dir}/brightness
}

dec() {
    local dec_bright=${1%*%}
    dec_bright=$(( dec_bright * max_brightness / 100))

    echo $(( -dec_bright + current_brightness )) > /sys/class/backlight/${sub_dir}/brightness
}

get_bright() {
    local bright
    bright=$(cat /sys/class/backlight/${sub_dir}/brightness)
    echo $(( bright * 100 / max_brightness ))
}

usage() {
    echo "help\n--------\n[-h] echo this message\n[-d] decrease brightness by percent\n[-i] increase brightness by percent\n[-s] set brightness in percent\n[-g] get brightness in percent\n"
}

case $1 in
    -h) usage;;
    -i) inc $2;;
    -d) dec $2;;
    -s) set_per_bright $2;;
    -g) get_bright;;
    *) usage;;
esac
