#!/bin/bash
# dmenu launcher with my patches

# get resolution, screen height, screen width, etc.
# resolution stuff stolen from mitch :p
res="$(xrandr --nograb --current | awk '/\*/ {print $1}')"
res=${res% *}
sw=${res%x*}
sh=${res#*x}
sw=${sw%.*}
sh=${sh%.*}

dmenu_w=$((sw / 2))
dmenu_lines=$((sw / 50))
dmenu_x=$((sw / 2 - dmenu_w / 2))
dmenu_y=$((sh / 6 + dmenu_lines))

source $HOME/var/cache/tm/colors/colors.sh

font="ShureTechMono Nerd Font:size=10"
selbg=$color8
selfg=$color15
normbg=$color0
normfg=$color7
borderpx=$(< /tmp/dwm_info/borderpx)
borcol=$color5

app_run() {
    dmenu_run -bpx $borderpx -x $dmenu_x -y $dmenu_y -w $dmenu_w\
        -l $dmenu_lines -fn "$font" -nf "$normfg" -nb "$normbg"\
        -sb "$selbg" -sf "$selfg" -p "run:"
    exit
}

sel() {
    [ $# -eq 0 ] && prompt="select:" || prompt="$1"
    dmenu -bpx $borderpx -x $dmenu_x -y $dmenu_y -w $dmenu_w\
        -l $dmenu_lines -fn "$font" -nf "$normfg" -nb "$normbg"\
        -sb "$selbg" -sf "$selfg" -p "$prompt"
    exit
}

case $1 in
    "sel")
        [ -z $2 ] && sel || sel "$2"
        ;;
    "run")
        app_run
        ;;
esac
