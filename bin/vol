#!/bin/dash
# simple dash script which increases the volume of Master (ALSA)
notify=0

usage() {
    echo "help\n----------\n[-h] echo this message\n[-i] increase volume by percent"
    echo "[-d] decrease volume by percent\n\
[-s] set volume in percent\n\
[-m] mute speakers\n\
[-u] unmute the speakers\n\
[-g] print the current volume"
}

inc() {
    amixer set Master $1+
}

dec() {
    amixer set Master $1-
}

setvol() {
    amixer set Master $1
}

mute() {
    amixer set Master mute
    echo 1 > /tmp/info/vol/muted
}

unmute() {
    amixer set Master unmute
    echo 0 > /tmp/info/vol/muted
}

get() {
    echo "$(cat /tmp/info/vol/cur)"
}

case ${1} in
(-n) notify=1;;
(-h) usage;;
(-i) inc ${2}; shift;;
(-d) dec ${2}; shift;;
(-m) mute;;
(-u) unmute;;
(-s) setvol ${2}; shift;;
(-g) get;;
(*) usage;;
esac

# get current volume and output that to a file which will be used by the bar
remkd /tmp/info/vol
amixer sget Master | awk -F '[][]' '{ print $2 }' | sed -e 's/%//' | tr -d '\n' > /tmp/info/vol/cur
[ ! -f /tmp/info/vol/muted ] && unmute
[ ${notify} -eq 1 ] && notify-send "volume" "$(get)%"
