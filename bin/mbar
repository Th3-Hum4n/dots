#!/bin/dash
# minimal bar
[ -n "$(pgrep -x lemonbar)" ] && { pkill -9 lemonbar; exit; }
[ -d "${HOME}/tmp/bar" ] && rm -rf "${HOME}/tmp/bar"
mkdir -p "${HOME}/tmp/bar"

. "${HOME}/var/cache/tm/colors.sh"
vol -i 0%
w=$(res -w)
h=$(res -h)

wksp() {
    [ $(cat /tmp/dwm_info/check) -eq 1 ]  && {
        i=1
        while [ ${i} -le $(cat /tmp/dwm_info/num_ws) ]; do
            [ $(cat /tmp/dwm_info/ws${i}) -eq 1 ] && ws="%{F${color5}}+ %{F-}" || ws="+ "

            [ $(cat /tmp/dwm_info/current_ws) -eq $i ] &&
                ws="* "

            buffer="${buffer}${ws}"
            i=$((i+1))
        done
        echo "${buffer}" > ${HOME}/tmp/bar/wksp
    }
} 2> /dev/null

(echo "%{l} $(wksp)$(cat ${HOME}/tmp/bar/wksp)" \
         "%{r} $(date +'%H:%M') ";
sleep 2;) |
    lemonbar -db \
             -f 'cherry:pixelsize=11' \
             -g "140x18+$((w - 170))+$((h - 40))" \
             -B ${color0} \
             -F ${color7} \
             -R ${color8} \
             -r 1 \
             -n "bar"
