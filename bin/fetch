#!/bin/dash
# a smol fetch script that suits my needs

# colors vars are down
blk="\033[38;5;0m"
red="\033[38;5;1m"
grn="\033[38;5;2m"
ylw="\033[38;5;3m"
blu="\033[38;5;4m"
pnk="\033[38;5;5m"
cyn="\033[38;5;6m"
wht="\033[38;5;7m"
dblk="\033[38;5;8m"
dred="\033[38;5;9m"
dgrn="\033[38;5;10m"
dylw="\033[38;5;11m"
dblu="\033[38;5;12m"
dpnk="\033[38;5;13m"
dcyn="\033[38;5;14m"
dwht="\033[38;5;15m"
null="\033[0m"

# function to create dashes
create_dashes() {
    num_dashes=$1
    local n=0
    while [ "$n" -lt $num_dashes ]; do
        n=$(( n + 1 ))
        local dashes="$dashes-"
    done

    echo $dashes
}

# function to get user and hostname
# in the format user@hostname
get_user_hostname() {
    echo "${blu}${USER}${dblu}@${blu}$(hostname)${null}"
}

# function to get the window manager
# I don't handle de here because I don't use it
get_wm() {
    # assuming that the setup is using xinitrc
    # let's get the last line
    # the second word will be our window manager
    local wm_name=$(tail -n 1 $HOME/.xinitrc | cut -d ' ' -f 2)

    echo $wm_name
}

get_distro_name() {
    case $(uname) in
        Linux)
            . /etc/os-release
            local distro=$PRETTY_NAME;;
        OpenBSD)
            local distro="OpenBSD";;
    esac

    echo $distro
}

get_package_count() {
    local osrelease="$(cat /etc/os-release)"

    if [ $(uname) = "Linux" ]; then
        case "$osrelease" in
            *"arch"* | *"Arch"*) local package_count=$(pacman -Qq | wc -l);;
            *"void"* | *"Void"*) local package_count=$(xbps-query -l | wc -l);;
        esac
    elif [ $(uname) = "OpenBSD" ]; then
        local package_count="$(ls -d /var/db/pkg/* | wc -l | sed -e 's/^[ \t]*//')"
    fi

    echo $package_count
}

get_uptime() {
    local utime="$(uptime -p | sed -e 's/up //')"

    echo "$utime"
}

terminal="st"
host_name="${USER}@$(hostname)"

echo $(get_user_hostname)
echo ${dblu}$(create_dashes ${#host_name})${null}
echo ${dpnk}os: ${dwht}$(get_distro_name)${null}
echo ${dpnk}wm: ${dwht}$(get_wm)${null}
echo ${dpnk}term: ${dwht}$terminal${null}
echo ${dpnk}sh: ${dwht}${SHELL}${null}
echo ${dpnk}uptime: ${dwht}$(get_uptime)${null}
echo ${dpnk}pkg_cnt: ${dwht}$(get_package_count)${null}
echo ${red}* ${blu}* ${grn}* ${ylw}* ${cyn}* ${pnk}*${null}
