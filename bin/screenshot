#!/bin/dash
# screenshot utility using maim and 0x0.st

tmp_image="/tmp/grab.png"

upload() {
    local url="$(curl -F file="@${tmp_image}" https://0x0.st)"
    # remove newline before copying it to clipboard
    echo "$url" | head -n 1 | tr -d "\n" | xclip -sel "clip"
    [ -n "$url" ] &&\
        notify-send "scrot taken!" "url in clipboard" ||\
        notify-send "error" "check if your internet is on"
}

grab_screen() {
    maim -u -d 1 --quiet > $tmp_image
}

grab_area() {
    maim -s > $tmp_image
}

grab_window() {
    maim -i $(xdotool getactivewindow) -d 1 > $tmp_image
}

capture="$(echo "grab area\ngrab window\ngrab screen" | menu sel)"

case $capture in
    *area*) grab_area;;
    *win*) grab_window;;
    *screen*) grab_screen;;
    *) notify-send "error" "invalid option"; exit;;
esac

upload

rm -rf $tmp_image
