#!/bin/mksh
case ${-} { (*i*) ;; (*) return;; }

alias echo='builtin print'
alias !!='\\builtin fc -e -'

set -o vi
set -o vi-tabcomplete
set -o nohup bgnice trackall

unalias r w

stty -ixon

HISTFILE="${HOME}/var/cache/mksh_history"
HISTSIZE=100000

_set_wn() {
    [[ ${TERM} != linux ]] && {
        local cwd="${PWD/${HOME}/\~}"
        echo -ne "\033]]0;mksh: ${cwd}\a"
    }
} 2> /dev/null

_rm_jnk() {
    _rm_e() {
        while [[ ${#} -gt 0 ]]; do
            [[ -d "${1}" || -f "${1}" ]] &&
                rm -rf "${1}"
            shift
        done
    }
    _rm_e ${XDG_DESKTOP_HOME} ${HOME}/{Desktop,.dbus,.pki,.wget-hsts}
    [[ -d ${HOME}/Downloads ]] &&
        [[ -z "$(ls ${HOME}/Downloads)" ]] && rm -rf ${HOME}/Downloads
    unset _rm_e
} > /dev/null

_PS1_command() {
    _set_wn; _rm_jnk
}

_draw_PS1() {
    case `whoami` {
    (root) echo -n '# ';;
    (viz)  echo -n '] '; _PS1_command;;
    (*)    echo -n '$ ';;
    }
}

export PS1='$(_draw_PS1)'
export PS2='... '

. ${HOME}/etc/aliases
