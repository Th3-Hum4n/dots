#!/bin/dash

sw=$(res -w)
sh=$(res -h)

w=$((sw / 2))

has bc && w=$(echo "${sw} / 2.3" | bc)

l=$((sw / 50))
x=$((sw / 2 - w / 2))
y=$((sh / 3 - l))

. ${HOME}/var/cache/tm/colors.sh

font="Share Tech Mono:size=10"
selbg=$(cat /tmp/info/dwm/colors/selbg)
selfg=$(cat /tmp/info/dwm/colors/selfg)
normbg=$(cat /tmp/info/dwm/colors/normbg)
normfg=$(cat /tmp/info/dwm/colors/normfg)
borderpx=$(cat /tmp/info/dwm/borders/size)
borcol=$(cat /tmp/info/dwm/borders/selcol)

sel() {
    dmenu -bp ${borderpx} -x ${x} -y ${y} -w ${w}           \
          -l ${l} -fn "${font}" -nf ${normfg} -nb ${normbg} \
          -sb ${selbg} -sf ${selfg} -i -bc ${borcol}        \
          -p "select:" ${@}
}

run() {
    surf() { tabbed -c surf -e; }
    draw() { draw_st; }
    st() { tabbed -c -r 2 st -w '' "${@}"; }
    todo() { st -e todo -i; }
    $(echo "surf
chromium
st
draw
dosbox
screenshot
turnoff
record
todo
dmenu_dir
view_image
subs" | sel -p "run:")
}

case ${1} in
("sel") shift; sel "${@}";;
("run"|*) run;;
esac
