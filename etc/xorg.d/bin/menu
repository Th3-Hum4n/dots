#!/bin/sh

sw=$(res -w)
sh=$(res -h)

w=$((sw / 2))

has bc && w=$(echo "${sw} / 2.3" | bc)

l=$((sw / 50))
x=$((sw / 2 - w / 2))
y=$((sh / 3 - l))

. ${HOME}/var/cache/tm/colors.sh

read -r borderpx < /tmp/info/wm/borders/size
read -r borcol   < /tmp/info/wm/borders/selcol

sel() {
    dmenu -bp ${borderpx} -x ${x} -y ${y} -w ${w} \
          -l ${l} -i -bc ${borcol}                \
          -p "select:" ${@}
}

run() {
    surf() { tabbed -c surf -e; }
    draw() { draw_st; }
    st() { tabbed -c -r 2 st -w '' "${@}"; }
    todo() { st -e todo -i; }
    `echo "chrome
st
draw
dosbox
screenshot
turnoff
record
todo
dmenu_dir
view_image
subs" | sel -p "run:"`
}

case ${1} in
(sel)
    shift
    case ${@} in (*-wi*) borderpx=0 ;; esac
    sel "${@}"
    ;;
(*)
    run
    ;;
esac
