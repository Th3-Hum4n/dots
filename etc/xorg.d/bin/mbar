#!/bin/dash
# minimal bar
[ -n "$(pgrep -x lemonbar)" ] && { pkill -9 lemonbar; exit; }
remkd /tmp/info/bar

. "${HOME}/var/cache/tm/colors.sh"
vol -i 0%
w=$(res -w)
h=$(res -h)

wksp() {
    local i=1
    while [ ${i} -le $(cat /tmp/info/dwm/tag/num) ]; do
        # check if occupied
        local state=$(cat /tmp/info/dwm/tag/${i})
        if [ ${state} -eq 1 ]; then
            ws="x "
        elif [ ${state} -eq 2 ]; then
            ws="@ "
        else
            ws="+ "
        fi

        # check if current
        [ $(cat /tmp/info/dwm/tag/current) -eq ${i} ] &&
            ws="* "

        buffer="${buffer}${ws}"
        i=$((i + 1))
    done
    echo "${buffer}" > /tmp/info/bar/wksp
} 2> /dev/null

(echo "%{l} $(wksp)$(cat /tmp/info/bar/wksp)" \
         "%{r} $(date +'%H:%M') ";
sleep 2;) |
    lemonbar -db \
             -f 'cherry:pixelsize=11' \
             -g "140x18+$((w - 170))+$((h - 40))" \
             -B ${color0} \
             -F ${color7} \
             -R ${color8} \
             -r 1 \
             -n "bar"
